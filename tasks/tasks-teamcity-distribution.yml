---

- name: "Teamcity | Get distribution"
  get_url:
    url: "https://download.jetbrains.com/charisma/youtrack-{{ teamcity_version }}.{{ teamcity_version_build }}.zip"
    dest: "/tmp/TeamCity-{{ teamcity_version }}.{{ teamcity_version_build }}.zip"
    validate_certs: no
  tags:
    - teamcity

- name: "Teamcity | Ensure directory is writable"
  file:
    path: "{{ teamcity_install_dir }}"
    state: directory
    mode: 0755
    recurse: true
  changed_when: false
  tags:
  - teamcity

- name: "Teamcity | Unpack distribution"
  unarchive:
    src: "/tmp/TeamCity-{{ teamcity_version }}.{{ teamcity_version_build }}.zip"
    dest: "{{ teamcity_install_dir }}"
    copy: "no"
  changed_when: false
  tags:
    - teamcity

- name: "Teamcity | Setup port in configuration"
  replace:
    dest: "{{ teamcity_install_dir }}/TeamCity/conf/server.xml"
    regexp: "8111"
    replace: "{{ teamcity_port }}"
  changed_when: false
  tags:
    - teamcity