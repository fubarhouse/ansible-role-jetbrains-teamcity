---

- name: "Teamcity | Get distribution"
  get_url:
    url: "https://download.jetbrains.com/teamcity/TeamCity-{{ teamcity_version }}.tar.gz"
    dest: "/tmp/TeamCity-{{ teamcity_version }}.tar.gz"
    validate_certs: no
  tags:
    - teamcity

- name: "Teamcity | Unpack distribution"
  unarchive:
    src: "/tmp/TeamCity-{{ teamcity_version }}.tar.gz"
    dest: "/tmp/"
    copy: "no"
  changed_when: false
  tags:
    - teamcity

- name: "Teamcity | Move distribution"
  shell: "mv /tmp/TeamCity/ {{ teamcity_parent_install_dir }}"

- name: "Teamcity | Setup port in configuration"
  replace:
    dest: "{{ teamcity_parent_install_dir }}/TeamCity/conf/server.xml"
    regexp: "8111"
    replace: "{{ teamcity_port }}"
  changed_when: false
  failed_when: false
  tags:
    - teamcity